<div id="wt"></div>
<div id="cal"></div>
<div id="stf"></div>
<img id="qr">
<!-- 800 x 480 -->
<script>
    function getQueryVariable(variable) {
        const query = window.location.search.substring(1);
        const vars = query.split('&');
        for (let i = 0; i < vars.length; i++) {
            const pair = vars[i].split('=');
            if (decodeURIComponent(pair[0]) == variable) {
                return decodeURIComponent(pair[1]);
            }
        }
        return undefined;
    }
    const ws = new WebSocket(`ws://${getQueryVariable('ip')}:${getQueryVariable('ws')}`);

    ws.onopen = function(event) {
        ws.send(JSON.stringify({ type: 'weather' }));
        ws.send(JSON.stringify({ type: 'stuffs', action: 'read' }));
        ws.send(JSON.stringify({ type: 'today' }));
        // TODO: send these interval
    };

    ws.onmessage = function (event) {
        const msg = JSON.parse(event.data);
        // msg.type === stuff, weather, today
        // ws.send("hi");
        if (msg.type === 'today') {
            if (msg.data.code === 1) {
                document.querySelector("#qr").src = msg.data.data;
            } else {
                document.querySelector("#cal").innerHTML += msg.data;
            }
            return;
        }
        if (msg.type === 'weather') {
            document.querySelector("#wt").innerHTML += event.data;
            return;
        }
        document.querySelector("#stf").innerHTML += event.data;
    };
</script>
